
<!--<script src="/file/70823524/0">TAB main-net</script>-->
<script src="/file/7359663/0">TAB test-net</script>
<!--<script src="/file/196/0">TAB local-net</script>-->

<script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
<script src="/smart/215">OrderLib test-net</script>
<script src="/file/8251388/0">OrderLib client part test-net</script>





<script>
    var DELTA_REMOVE=50;
    OLib.WORK_DELTA=2;//отступ от краев внутри разрешенного диапазона работы
    OLib.ContractAddr="";

    var MAX_OLD_ORDER_LENGH=20;

    ALL_ACCOUNTS=1;
    var TESTMODE=0;

    var glPrivKey;
    var SaveIdArr=["idMode","idAddrTera","idAddrEth","idAmount","idTransferFee","idDescription", "idPrivKey"];
    var OrderArr=[];
    var MonitorMode="MY";
    var PrevMonitorMode;
    var MapPending={};
    var SendEthMap={};
    var glSendNum=0;

    var CurrentFormUID=0;
    //---------------------------------------------------------------------------
    //---------------------------------------------------------------------------




    //---------------------------------------------------------------------------
    //---------------------------------------------------------------------------

    window.addEventListener('Init',function ()
    {
        if(SMART.Num===7)
            TESTMODE=1;

        CheckArr();
        LoadValues();
        CalcSecret();

        SmartGetInfo();
        PrepareSavingItems();
        UpdateOrderList(1,1);

        GetConfTera();
        //GetCommonEth();

    });
    window.addEventListener('UpdateInfo',function ()
    {
        CheckArr();
        UpdateOrderList();
    });

    window.addEventListener('Event',function(e)
    {
        var Msg=e.detail;
        var Data=Msg.Description;

        if(Msg.Error)
        {
            SetError(Data);
        }
        else
        if(Data.cmd==="AddOrder")
        {
            delete MapPending[Data.UID];
            if(Data.UID===CurrentFormUID && idDescription.value!=="-")
                ClearSend();
        }

        var Str;
        if(typeof Data==="object")
            Str=JSON.stringify(Data,"",4)
        else
            Str=Data;
        idLogs.value=Str+"\n-------\n"+idLogs.value;
        //console.log(Data);

        UpdateTeraCache(Data);

    });

    function CheckArr()
    {
        var bOwner=0;
        var Arr=[];
        for(var i=0;i<USER_ACCOUNT.length;i++)
        {
            var Item=USER_ACCOUNT[i];
            if(SMART.Owner===Item.Num)
                bOwner=1;

            if(Item.Currency!==0)//todo
                continue;
            if(SMART.Num!==Item.Value.Smart)
                continue;

            var Value={value:Item.Num, text:Item.Num+"."+Item.Name+"  "+SUM_TO_STRING(Item.Value,Item.Currency,1)};
            Arr.push(Value);
        }

        SetVisibleBlock("mOwner",bOwner);

        FillSelect("idAddrTera",Arr);
    }

    function Round(Sum)
    {
        return Math.floor(Sum*1e9)/1e9;
    }



    //--------------------------------------------------------------------------- ETH Coin
    async function AddCoin()
    {
        var tokenAddress=await CallEth("Token");
        if(!tokenAddress)
            return;

        const tokenSymbol = 'TERA';
        const tokenDecimals = 9;
        const tokenImage = 'https://terawallet.org/tera.ico';



        try {
            // wasAdded is a boolean. Like any RPC method, an error may be thrown.
            const wasAdded = await ethereum.request({
                method: 'wallet_watchAsset',
                params: {
                    type: 'ERC20', // Initially only supports ERC20, but eventually more!
                    options: {
                        address: tokenAddress, // The address that the token is at.
                        symbol: tokenSymbol, // A ticker symbol or shorthand, up to 5 chars.
                        decimals: tokenDecimals, // The number of decimals in the token
                        image: tokenImage, // A string url of the token logo
                    },
                },
            });
        }
        catch (error)
        {
            console.log(error);
        }
    }

    //--------------------------------------------------------------------------- ETH Send

    function FindOrderByID(ID)
    {
        if(ID)
            for(var i=0;i<OrderArr.length;i++)
            {
                var Order=OrderArr[i];
                if(Order.ID===ID)
                {
                    return Order;
                }
            }
        return SetError("Error order ID");
    }

    async function SendIDToEth(ID,btn)
    {
        btn.disabled = true;

        var Order=FindOrderByID(ID);
        if(Order)
        {
            try
            {
                var Ret=await SendExecOrderEth(Order);
                console.log(Ret);
            }
            catch(e){};
        }
    }


    async function SendExecOrderEth(Order)
    {
        var Conf=await GetConfTera();
        if(!Conf || !Conf.NOTARY || !Conf.NOTARY.MinSign)
            return SetError("Error Tera Conf");

        SendEthMap[Order.ID]=1;
        var Buf=[];
        EncodeOrder(Buf,Order,1,Conf.NOTARY.MinSign);
        console.log("ETH Length:",Buf.length,ToBytes(Buf));
        return SendEth("ExecOrder",ToBytes(Buf));
    }



    function SendIDToSlash(ID,btn)
    {
        btn.disabled = true;

        var Order=FindOrderByID(ID);
        if(Order && OLib.ConfTera)
        {
            var Order2=CopyObjKeys({},Order);
            delete Order2.SignArr;
            for(var i=0;i<Order.SignArr.length;i++)
            {
                var Item=Order.SignArr[i];
                if(!Item.Slash)
                {
                    Order2.Notary=Item.Notary;
                    MSendCall(OLib.ConfTera.NotarySmartAcc,"SlashProof",Order2,Item.Sign,0);
                }
            }
        }
    }
    async function SendIDToRefund(ID,btn)
    {
        btn.disabled = true;

        var Order=FindOrderByID(ID);
        if(Order && OLib.ConfTera)
        {
            if(Order.Mode==1)
                MSendCall(OLib.ConfTera.NotarySmartAcc,"CancelOrder",{ID:Order.ID},[],0);
            else
            {
                var Ret=await SendEth("CancelOrder",ID);
                console.log(Ret);
                delete OLib.MAP_ETH[ID];
            }
        }
    }

    async function SendIDToSign(ID,btn)
    {
        btn.disabled = true;

        var Order=FindOrderByID(ID);
        if(Order && OLib.ConfTera)
        {
            if(Order.Mode==2)
            {

                var SignStr=GetHexFromArr(GetSignOrder(Order,glPrivKey));
                var StrR=SignStr.substr(0,32*2);
                var StrS=SignStr.substr(32*2,32*2);
                var StrV=SignStr.substr(64*2,2);

                console.log(StrR,StrS,StrV);

                var Ret=await SendEth("NotarySign",ID,0,ToBytes(StrR),ToBytes(StrS),ToBytes(StrV));
                console.log(Ret);
                delete OLib.MAP_ETH[ID];
            }
        }
    }


    //--------------------------------------------------------------------------- TERA Send
    async function SendCoins()
    {
        await ["idMode","idAddrTera","idAddrEth","idAmount"].forEach(function(id)
        {
            if(!$(id).value)
            {
                SetError("Need set "+id.substr(2));
                throw "Error";
            }

        });

        var Conf=await GetConfTera();

        if(!Conf.NOTARY.NotaryArr)
            return SetError("Error Notary dapp params");

        let Order=FormToOrder(Conf);
        if(!Order)
            return;
        var option=idMode.options[Order.Mode-1];
        DoConfirm("Send "+option.innerText,CreateSendHTML(Order),async function()
        {
            SelectTabMenu("mMonitor");
            SelectTabMenu("mMy");
            SetMonitorMode("MY");

            glSendNum++;
            let UID=Order.AddrTera*1000+(glSendNum%1000);
            Order.UID=UID;
            CurrentFormUID=Order.UID;

            Order.ID=GetCurrentBlockNumByTime()*1000;
            Order.Pending=1;
            Order.SignArr=[];
            MapPending[Order.UID]=Order;

            UpdateOrderList(1);

            if(Order.Mode==2)//Mode Eth to Tera
            {
                try
                {
                    var RetSend=await SendAddOrderEth(Order);
                    console.log(RetSend);
                }
                catch(e){};

                delete MapPending[UID];
            }
            else
            {
                if(!MSendCall(+idAddrTera.value,"SendOrder",Order,[],+idAddrTera.value))
                    return;
            }
        });
    }
    function DoConfirm3(a,b,F)
    {
        F();
    }


    function FormToOrder(Conf)
    {
        if(!Conf)
            Conf=OLib.ConfTera;
        if(!Conf)
            return;

        var NOTARY=Conf.NOTARY;

        var Order=
            {
                Mode:+idMode.value,
                AddrTera:+idAddrTera.value,
                AddrEth:idAddrEth.value,
                Amount:Round(+idAmount.value),
                TransferFee:Round(+idTransferFee.value),
                Description:idDescription.value,
            }

        Order.AddrEth=ToBytes(Order.AddrEth).substr(2);
        Order.NotaryFee=0;
        if(Order.Mode==1)
        {
            var NeedFee=NOTARY.Rate*NOTARY.NotaryFee*(Order.Amount+Order.TransferFee);
            Order.NotaryFee=Round(Math.max(NeedFee,NOTARY.MinNotaryFee));
        }
        return  Order;
    }

    function CreateSendHTML(Order)
    {
        var Arr=[];
        Arr[(Order.Mode+1)%2]=Order.AddrTera;
        Arr[(Order.Mode)%2]=Order.AddrEth;

        var TokenName=CurrencyName(USER_ACCOUNT_MAP[Order.AddrTera].Currency);

        var Str=`
        <DIV align='left'>
        <hr>
        <txtr><txth>From:</txth><txtshort>${Arr[0]}</txtshort></txtr>
        <txtr><txth>To:</txth><txtshort>${Arr[1]}</txtshort></txtr>
        <txtr><txth>Amount:</txth><txtvo>${Order.Amount}</txtvo>
        <txthfee class="${Order.Mode==2?'hide':''}">Transfer:<txtvo>${Order.TransferFee}</txtvo>Notary:<txtvo>${Order.NotaryFee}</txtvo></txthfee></txtr>
        <txtr><txth>Description:</txth><txtv>${Order.Description}</txtv></txtr>
        <hr>
        <txtr><txth>TOTAL:</txth><txtvo>${Round(Order.Amount+Order.NotaryFee+Order.TransferFee)}</txtvo>${TokenName}</txtr>

        </DIV>`

        return Str;
    }

    function ClearSend()
    {
        ["idAddrTera","idAddrEth","idAmount","idTransferFee","idDescription"].forEach(id => $(id).value="");
    }

    //--------------------------------------------------------------------------- Process Tera orders

    function IsMyOrder(Order)
    {
        if(USER_ACCOUNT_MAP[Order.AddrTera] || USER_ACCOUNT_MAP[Order.AddrEth] || TESTMODE)
            return 1;
        else
            return 0;
    }

    function GetShortAddr(Addr)
    {
        if(Addr.substr(0,2)==="0x")
            Addr=Addr.substr(2);
        return Addr.substr(0,4)+"..."+Addr.substr(Addr.length-4);
    }
    function GetViewOrder(Item)
    {
        var Str=GetShortAddr(Item.AddrEth);
        return "<a class='olink' target='_blank' onclick='ViewOrder(" + Item.ID + ")'>" + Str + "</a>";
    }
    function GetDirectOrder(Item)
    {
        if(Item.Mode==2)
            return '<span class="orange">←<span>';
        else
            return '<span class="green">→<span>';

    }
    function Short8(Value)
    {
        if(!Value)
            return "-";
        return Value.substr(0,8);
    }
    function ViewOrder(ID)
    {
        var Order=FindOrderByID(ID);
        if(Order)
        {
            console.log(Order);
        }
    }

    function SetStateOrder(Item)
    {
        SetOrderPeriod(Item);
        Item.Err=0;
        if(!Item.Mode)
            Item.Mode=1;

        if(Item.PeriodNum>=4)
        {
            Item.State=Item.Period;
        }
        else
        {
            if(Item.Mode==1)
                SetStateOrder1(Item);
            else
                SetStateOrder2(Item);
        }
    }

    function SetStateOrder1(Item)
    {

        if(Item.HashEth && Item.HashTera!==Item.HashEth)
            Item.Err=1;

        if(Item.InEth)
        {

            if(Item.Err)
            {
                if(Item.Process!==200 && Item.PeriodNum>1 && Item.PeriodNum<=3)
                    Item.State="ToSlash";
                else
                    Item.State=Item.Period;
            }

            if(!Item.Err)
            {
                Item.State="Transferred";
                Item.Final=1;
            }
        }
        else
        {
            if(Item.Pending)
                Item.State="Pending";
            else
            if(Item.Process===1 && Item.InEth!==null)
                Item.State="ToEth";
            else
            if(Item.Process===0 && Item.PeriodNum>=3)//Checking
                Item.State="ToRefund";
            else
            if(Item.Process===100)
            {
                Item.State="Refunded";
                Item.Final=1;
            }
            else
                Item.State=Item.Period;
        }
    }

    function SetStateOrder2(Item)
    {

        if(Item.HashTera && Item.HashTera!==Item.HashEth)
            Item.Err=1;

        if(Item.InTera)
        {

            if(Item.Err)
            {
                if(Item.Process!==200 && Item.PeriodNum>1 && Item.PeriodNum<=3)
                    Item.State="ToSlash";
                else
                    Item.State=Item.Period;
            }

            if(!Item.Err)
            {
                Item.State="Transferred";
                Item.Final=1;
            }
        }
        else
        {
            if(Item.Pending)
                Item.State="Pending";
            else
            if(Item.Process===0 && Item.PeriodNum===2)
                Item.State="ToSign";
            else
            if(Item.Process===1)
                Item.State="ToTera";
            else
            if(Item.Process===0 && Item.PeriodNum>=3)//Checking
                Item.State="ToRefund";
            else
            if(Item.Process===100)
            {
                Item.State="Refunded";
                Item.Final=1;
            }
            else
                Item.State=Item.Period;
        }
    }

    function GetBtActOrder(Item)
    {
        //Process
        var Str="-";
        if(Item.State==="ToEth" && OLib.WasMetaMaskInstalled)
        {
            var color="green";
            if(SendEthMap[Item.ID])
                color="gray";
            Str='<button class="btaction '+color+'" onclick="SendIDToEth('+Item.ID+',this)">Send</button>';
        }
        else
        if(Item.State==="ToSlash" && Item.PeriodNum>=3)
            Str='<button class="btaction red" onclick="SendIDToSlash('+Item.ID+',this)">Slash</button>';
        else
        if(Item.State==="ToRefund")
            Str='<button class="btaction orange" onclick="SendIDToRefund('+Item.ID+',this)">Refund</button>';
        else
        if(Item.State==="ToSign")
            Str='<button class="btaction green" onclick="SendIDToSign('+Item.ID+',this)">Sign</button>';

        return Str;
    }
    function ColoredAmount(Item)
    {
        var Str=Item.Amount;
        if(Item.Err)
            Str="<span class='red'>"+Str+"</span>"
        return Str;
    }




    //--------------------------------------------------------------------------- List orders
    async function UpdateOrderList(OnlyTera,bInit)
    {
        if(bInit && TESTMODE)
        {
            SmartGetEmpty();
            SmartSetInfo()
        }

        var Map={};

        //Pending
        for(var UID in MapPending)
        {
            var Order=MapPending[UID];
            Map[Order.ID]=Order;
        }


        var Arr=await GetOrderListTera(0);
        for(var i=0;i<Arr.length;i++)
        {
            var Order=Arr[i];
            Order.InTera=1;
            Order.HashTera=GetHexFromArr(GetOrderHash(Order));
            if(!Order.InEth)
                Order.InEth=(bInit)?null:0;
            Map[Order.ID]=Order;
        }

        Arr=await GetOrderListTera(1);
        for(var i=0;i<Arr.length;i++)
        {
            var Order=Arr[i];
            Order.InTera=1;
            if(!Map[Order.ID])
            {
                Order.HashTera=GetHexFromArr(GetOrderHash(Order));
                Map[Order.ID]=Order;
            }
        }

        //Eth
        if(!OnlyTera)
        {
            for(var Mode=1;Mode<=2;Mode++)
            {
                Arr=await GetOrderListEth(Mode);
                for(var i=0;i<Arr.length;i++)
                {
                    var Order;
                    var OrderEth=Arr[i];
                    OrderEth.Mode=Mode;
                    var Order=Map[OrderEth.ID];
                    if(!Order)
                    {
                        Map[OrderEth.ID]=OrderEth;
                        Order=OrderEth;
                    }
                    SetAttrEthOrder(Order,OrderEth);
                }
            }
        }
        Arr=[];
        for(var ID in Map)
        {
            var Order=Map[ID];
            Order.Num=Order.ID;

            SetStateOrder(Order);

            Arr.push(Order);
        }

        Arr.sort(function(a,b){return a.ID-b.ID;})


        OrderArr=Arr;
        ViewMonitor();

    }
    async function SetAttrEthOrder(Order,OrderEth)
    {
        Order.InEth=1;
        Order.HashEth=GetHexFromArr(GetOrderHash(OrderEth));
        Order.EthNextID=OrderEth.NextID;
        Order.EthPrevID=OrderEth.PrevID;
        if(!OrderEth.NotaryFee)
            OrderEth.NotaryFee=0;

    }





    function ViewMonitor()
    {
        var Arr=[];
        if(MonitorMode==="ALL")
            Arr=OrderArr;
        else
            for(var i=0;i<OrderArr.length;i++)
            {
                var Item=OrderArr[i];
                if(Item.State===undefined)
                    console.log(Item);
                if(Item.PeriodNum>=4)
                    continue;

                // if(MonitorMode==="MY" && !Item.Final && IsMyOrder(Item))
                //     Arr.push(Item);
                // else
                // if(MonitorMode==="MYFINISH" && Item.Final && IsMyOrder(Item))
                //     Arr.push(Item);
                if(MonitorMode==="MY" && IsMyOrder(Item))
                    Arr.push(Item);
                else
                if(MonitorMode==="SLASH" && Item.State==="ToSlash")
                    Arr.push(Item);
                else
                if(MonitorMode==="TOETH" && Item.State==="ToEth")
                    Arr.push(Item);
                else
                if(MonitorMode==="TOTERA" && Item.State==="ToTera")
                    Arr.push(Item);
                else
                if(MonitorMode==="REFUND" && Item.State==="ToRefund")
                    Arr.push(Item);


            }
        SetGridData(Arr,"idOrders",undefined,MonitorMode!==PrevMonitorMode,1);
        PrevMonitorMode=MonitorMode;
    }

    function SetMonitorMode(Str)
    {
        MonitorMode=Str;
        ViewMonitor();
    }

    function SetEthCurAddres()
    {
        idAddrEth.value=OLib.EthAddrFrom;
        SaveValues();
    }

    //--------------------------------------------------------------------------- Owner smart
    function SmartGetEmpty()
    {
        var Params=
            {
                CommonNum:0,
                EthSmartAddr:"",
                // TokenPoolAcc:0,
                NotarySmartAcc:0,
            };
        if(TESTMODE)
        {
            Params.NotarySmartAcc=602;
            Params.Channel=606;//652;
        }
        idList2.value=JSON.stringify(Params,"",4);
    }

    function SmartSetInfo()
    {
        if(!idList2.value)
            return SetError("Need set params");
        var Params=JSON.parse(idList2.value);
        delete Params.NOTARY;
        SendCall(0,"SetInfo",Params,[],SMART.Owner);
    }



    async function SmartGetInfo(bReset)
    {
        OLibClearCahce();

        var Conf=await GetConfTera();
        idList2.value=JSON.stringify(Conf,"",4);
    }

    //---------------------------------------------------------------------------

    function SetVisibleSendForm()
    {
        SetVisibleBlock("idBlockTrFee",idMode.value==1);
    }

    //--------------------------------------------------------------------------- Private key support
    function SetPubKey()
    {
        glPubKey=SignLib.publicKeyCreate(glPrivKey, 0);
        glAddr=GetHexFromArr(GetAddrFromPubKey(glPubKey));
        idPubKey.value=glAddr;
        SaveValues();
    }

    function CalcSecret()
    {
        idPrivKey.value=idPrivKey.value.trim();
        if(idPrivKey.value)
        {
            glPrivKey=GetArrFromHex(idPrivKey.value);
            SetPubKey();
        }
        else
        {
            var PubKey=[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2];

            ComputeSecret(PubKey,function (ArrSecret)
            {
                glPrivKey=ArrSecret;
                SetPubKey();
            },+idAddrTera.value);
        }

    }
    function ShowPrivKey()
    {
        idPrivKey.value=GetHexFromArr(glPrivKey);
        SetPubKey();


        SetVisibleBlock("idPrivKey",1);
        setTimeout(function()
        {
            SetVisibleBlock("idPrivKey",0);
        },10*1000);
    }

    //--------------------------------------------------------------------------- Saving support
    function SaveValues()
    {
        CurrentFormUID=0;
        SaveToStorageByArr(SaveIdArr);
    }
    function LoadValues()
    {
        LoadFromStorageByArr(SaveIdArr,function (Key)
        {
            SetVisibleSendForm();
            CalcSecret();
        },1);
    }
    function PrepareSavingItems()
    {
        for(var n = 0; n < SaveIdArr.length; n++)
        {
            var Item = $(SaveIdArr[n]);
            Item.addEventListener("change",SaveValues);
        }
    }

</script>




<style>
    body
    {
        background-color: #2E3857;
        color: white;
    }

    input
    {
        width: 70px;
    }

    button
    {
        height: 26px;
        width: 95px;
        margin: 5px;
        color:white;
        background-color: #2E3857;
        border: 1px solid #888;
    }
    button[disabled]
    {
        color: gray;
        cursor:none;
    }

    button:hover
    {
        color: #cb763a;
        cursor: pointer;
    }
    button[disabled]:hover
    {
        color: gray;
        cursor:none;
    }
    .btaction
    {
        width: 70px;
        padding:0;
        margin:0;
        height:26px;
    }
    .btlist
    {
        width: 150px;
        height:40px;
        margin:10px 2px 30px 2px;
    }

    .raw
    {
        margin: 10px 5px;
        font-size: 16px;
    }
    .raw-head
    {
        display: block;
        margin: 2px;
        text-align: left;
    }
    .raw-item
    {
        background-color2: #CCC;
        margin: 2px;
        padding:0px;
        height:30px;
        width:99%;
    }
    .amount
    {
        color:#1e21cb;
        font-weight: bold;
    }
    .raw2
    {
        display: flex;
        margin: 10px 5px;
        font-size: 16px;
    }
    .rawtr
    {
        width: 30%;
        margin: auto;
    }

    txtr
    {
        display: -webkit-box;
        display: -webkit-flex;
        display: -ms-flexbox;
        margin: 5px;
    }
    txth
    {
        font-weight: bold;
    }
    txthfee
    {
        font-weight: normal;
        font-size: 12px;
    }

    txtv
    {
        margin-left: 5px;
    }
    txtvo
    {
        margin-left: 5px;
        color:#E9764B;
        font-weight: bold;
        padding: 0 5px;
    }
    txtshort
    {
        margin-left: 5px;
        font-size: 12px;
        padding-top:3px;
    }

    #idConfirm
    {
        background-color:#DBE2F8;
        max-width: 300px;
    }
    #idConnect
    {
        height:50px;
        width:200px;
    }

    .hide
    {
        display: none;
    }


    /*Списки*/
    table
    {
        border-collapse: collapse;
        width:100%;
        max-width: 800px;
        margin-top:5px;

    }
    .grid th
    {
        color2:lightgray;
    }

    .grid th, .grid td
    {
        border: 1px solid #576B83;
        padding: 4px;
    }
    .grid td
    {
        color:lightgray;
        width: 60px;
        vertical-align:top;
    }

    .red
    {
        color:red;
    }
    .green
    {
        color:lightgreen;
    }
    .orange
    {
        color:orange;
    }
    .gray
    {
        color: gray;
    }

    td.desc
    {
        max-width: 150px;
        text-align: left;
        word-break: break-all;
        overflow:auto;
    }

    .set
    {
        width: 18px;
        border:0;
        padding:0;
        margin:0;
    }

</style>

<div align="center" style="width:98%">
    <div align="left" style="max-width:800px">

        <div align='center' id="idMain" style="display:none">

            <menu>

                <item data-ref="mMonitor" id="mMonitor">
                    MONITOR
                </item>

                <item data-ref="mSend" id="mSend">
                    SEND
                </item>

                <item data-ref="mInfo" id="mInfo">
                    INFO
                </item>

                <item data-ref="mOwner" id="mOwner">
                    OWNER
                </item>

            </menu>





            <content data-ref="mInfo">

                <!--Common TERA-ETH Bridge information-->

                <button style="width:150px" onclick="AddCoin()">Link Tera to Metamask</button>

            </content>

            <content data-ref="mMonitor">


                <menu  style="max-width:600px">
                    <item onclick="SetMonitorMode('MY')" id="mMy">
                        MY
                    </item>
                    <!--<item onclick="SetMonitorMode('MYFINISH')">-->
                    <!--    FINISH-->
                    <!--</item>-->
                    <item onclick="SetMonitorMode('ALL')">
                        ALL
                    </item>
                    <item onclick="SetMonitorMode('TOTERA')">
                        TO TERA
                    </item>
                    <item onclick="SetMonitorMode('TOETH')">
                        TO ETH
                    </item>

                    <item onclick="SetMonitorMode('REFUND')">
                        REFUND
                    </item>
                    <item onclick="SetMonitorMode('SLASH')">
                        SLASH
                    </item>

                </menu>


                <table id="idOrders" class="grid">
                    <tr>
                        <th id="(GetBtActOrder(Item))">Action</th>
                        <th id="Item.State">State</th>
                        <th id="(ColoredAmount(Item))" class="sum bold">Amount</th>
                        <!--<th id="Item.Channel">Channel</th>-->
                        <th id="Item.NotaryFee" class="sum bold">Fee Notary</th>
                        <th id="Item.TransferFee" class="sum bold">Fee Transfer</th>
                        <th id="Item.AddrTera" class="">Addr Tera</th>
                        <th id="(GetDirectOrder(Item))" class="">↔</th>
                        <th id="(GetViewOrder(Item))" class="">Addr Eth</th>
                        <th id="Item.Description" class="desc">Description</th>
                        <th id="Item.SignArr.length" class="">Notary signs</th>

                        <!--<th id="Short8(Item.HashTera)" class="hash">Tera</th>-->
                        <!--<th id="Short8(Item.HashEth)" class="hash">Eth</th>-->
                        <th id="Item.ID" class="id">ID</th>
                        <!--<th id="Item.NextID" class="id">Next</th>-->
                        <!--<th id="Item.EthPrevID!==undefined?Item.EthPrevID:'-'" class="id">Eth Prev</th>-->
                        <!--<th id="Item.EthNextID!==undefined?Item.EthNextID:'-'" class="id">Eth Next</th>-->

                        <th id="Item.InTera?1:0">Tera</th>
                        <th id="Item.InEth===null?'-':Item.InEth?Item.InEth:0">Eth</th>
                        <th id="Item.PeriodNum">Period</th>
                        <!--<th id="Item.Process">Process</th>-->
                    </tr>
                </table>


            </content>

            <content data-ref="mSend" style="max-width:400px">
                <div align="left">
                    <div class="raw">
                        <div class="raw-head">Bridge mode:</div>
                        <select size="1" id="idMode" class="raw-item" style="width: 120px" onchange="SetVisibleSendForm()">
                            <option value="1">TERA → ETH</option>
                            <option value="2">ETH  → TERA</option>
                        </select>
                    </div>
                    <div class="raw">
                        <div class="raw-head">Address Tera:</div>
                        <select size="1" id="idAddrTera" class="raw-item" style="width:100%;">
                            <option value="0">Loading...</option>
                        </select>
                    </div>
                    <div class="raw">
                        <div class="raw-head">Address Eth:
                            <button onclick="SetEthCurAddres()" class="set">
                                <img src="./img/load.svg">
                            </button>
                        </div>

                        <input type="string" id="idAddrEth" class="raw-item">
                    </div>
                    <div class="raw2">
                        <div class="raw">
                            <div class="raw-head">Amount:</div>
                            <input type="number" id="idAmount" class="raw-item amount" style="text-align:right;">
                        </div>
                        <div id="idBlockTrFee" class="raw rawtr">
                            <div class="raw-head">Transfer fee:</div>
                            <input type="number" id="idTransferFee" class="raw-item amount" style="text-align:right;">
                        </div>
                    </div>

                    <div class="raw">
                        <div class="raw-head">Description:</div>
                        <TEXTAREA id="idDescription" rows="2" cols="30" class="raw-item"></TEXTAREA>
                    </div>
                    <div class="raw">
                        <button onclick="SendCoins()">SEND</button>
                        <button onclick="ClearSend()">CLEAR</button>
                    </div>
                </div>

            </content>


            <content data-ref="mOwner">

                <menu>
                    <item data-ref="sSmart">
                        SMART
                    </item>
                    <item data-ref="sSign">
                        SIGN
                    </item>
                    <item data-ref="mLog" id="tlog">
                        Logs
                    </item>

                </menu>

                <content data-ref="sSmart">
                    <button onclick="SmartGetEmpty()">Empty</button>
                    <button onclick="SmartGetInfo()">Get</button>
                    <button onclick="SmartSetInfo()">Set smart</button>
                    <br>

                    <TEXTAREA id="idList2" rows="20" cols="40" style="width:99%"></TEXTAREA>
                    <input type="number" id="idAccGetInfo">
                </content>

                <content data-ref="mLog">
                    <button onclick="idLogs.value=null">Clear</button>
                    <TEXTAREA id="idLogs" rows="22" cols="40" style="width:99%"></TEXTAREA>
                </content>

                <content data-ref="sSign">
                    Addr:
                    <TEXTAREA id="idPubKey" rows="2" cols="40" style="width:99%"></TEXTAREA>
                    Privat key:
                    <TEXTAREA id="idPrivKey" rows="3" cols="40" style="display:none; width:99%" onchange="CalcSecret();"></TEXTAREA>
                    <button onclick="CalcSecret()">Calc Secret</button>
                    <button onclick="ShowPrivKey()">Show Secret</button>
                    <button onclick="idPrivKey.value=null;CalcSecret()">Reset secret</button>
                </content>

            </content>



        </div>
    </div>
</div>



